angular.module("RDash",["ui.bootstrap","ui.router","ngCookies","ngMap","ngResource"]);
"use strict";angular.module("RDash").config(["$stateProvider","$urlRouterProvider","$httpProvider",function(t,e,l){e.otherwise("/"),t.state("Index",{url:"/",controller:"IndexController"}).state("Login",{url:"/login",templateUrl:"templates/login.template.html",controller:"LoginController"}).state("Register",{url:"/register",templateUrl:"templates/register.template.html",controller:"RegisterController"}).state("App",{url:"/app",templateUrl:"templates/app.template.html",controller:"AppController"}).state("App.Dashboard",{url:"/dashboard",templateUrl:"templates/dashboard.html",controller:"DashboardController",controllerAs:"Dashboard"}).state("App.Accidents",{url:"/accidents",templateUrl:"templates/accidents.template.html",controller:"AccidentsController"}).state("App.Users",{url:"/users",templateUrl:"templates/users.template.html",controller:"UsersController"}).state("App.Maps",{url:"/maps",templateUrl:"templates/maps.template.html"}).state("App.Profile",{url:"/profile",controller:"UserController",templateUrl:"templates/user.template.html"})}]);
"use strict";angular.module("RDash").run(["$rootScope","$state",function(t,e){t.$on("$stateChangeStart",function(t,o,r){o.redirectTo&&(t.preventDefault(),e.go(o.redirectTo,r,{location:"replace"}))})}]);
angular.module("RDash").filter("capitalize",function(){return function(r){return r?r.charAt(0).toUpperCase()+r.substr(1).toLowerCase():""}});
angular.module("RDash").controller("AccidentsController",["$scope","$http","$uibModal","Accidents","$cookies",function(e,t,o,n,c){function l(){e.token=c.get("token"),t({method:"GET",url:"http://localhost:3000/accidents?limit="+e.limit+"&offset="+e.offset,headers:{"x-access-token":e.token}}).then(function(t){e.personalDetails=t.data},function(e){}),user=JSON.parse(c.get("user")),console.log(user),console.log(user.userType),"Admin"===user.userType&&(e.isEditable=!0)}e.isAllSelected=!1,e.limit=100,e.offset=0,e.deleteAccidents=function(){var t=[];angular.forEach(e.personalDetails,function(o){o.selected?(console.log(o),n["delete"]({accidentId:o._id},function(){console.log("accidents deleted")},function(e){console.log("accidents not deleted")})):t.push(o),e.personalDetails=t})},e.personalDetails=[],e.nextAccidents=function(o){e.offset+=o,e.offset>0?(e.token=c.get("token"),t({method:"GET",url:"http://localhost:3000/accidents?limit="+e.limit+"&offset="+e.offset,headers:{"x-access-token":e.token}}).then(function(t){e.personalDetails.length?(e.personalDetails=t.data,e.disableNext=!1):e.disableNext=!0},function(e){})):console.log("offset negative")},l(),e.toggleAll=function(){var t=e.isAllSelected;angular.forEach(e.personalDetails,function(e){e.selected=t})},e.optionToggled=function(){e.isAllSelected=e.personalDetails.every(function(e){return e.selected})},e.openDetails=function(e){console.log(e);var t=!1;o.open({templateUrl:"/templates/Popuptemplate.html",controller:"PopinController",resolve:{Accident:function(){return e},Mode:function(){return t}}})},e.openEditor=function(){var e=!0;o.open({templateUrl:"/templates/Popuptemplate.html",controller:"PopinController",resolve:{Accident:function(){return null},Mode:function(){return e}}})}}]),angular.module("RDash").controller("PopinController",["$scope","$http","$uibModalInstance","Accidents","Accident","Mode","$cookies",function(e,t,o,n,c,l,s){e.ok=function(){o.dismiss("cancel")},console.log(c),c&&(e.accident=c),l?e.mode=l:e.mode=!1,e.closeDetails=function(){o.close()},e.savedetails=function(e){n.update({accidentId:e._id},e,function(e){o.close()})},e.createAccident=function(e){n.save(e,function(e){console.log("Success"),o.close()})},e.ajouterCommentaire=function(o){var n=JSON.parse(s.get("user"));e.token=s.get("token"),t({method:"POST",url:"http://localhost:3000/comments/accidents",headers:{"x-access-token":e.token},data:{usersId:n._id,accidentID:c._id,Num_Comment:e.Nbr_Comments+1,accidentNum:c.Num_acc,content:o}}).then(function(e){console.log(e),e.data.success&&i()},function(e){})};var i=function(){e.token=s.get("token"),t({method:"GET",url:"http://localhost:3000/comments/accidents/"+c._id,headers:{"x-access-token":e.token}}).then(function(t){console.log(t),e.comments=t.data.content},function(e){})};i()}]);
function AppController(o,e,r,t,p){e.$state=t;var s=o.get("token");e.token=s,r.user=o.getObject("user"),s?"Admin"===r.user.userType?t.go("App.Dashboard"):t.go("App.Maps"):(console.log(r.register),t.go("Login"))}angular.module("RDash").controller("AppController",["$cookies","$scope","$rootScope","$state","$http",AppController]);
function DashboardController(t,e,o,n,s){function c(){e.query(function(e){t.users=e}),t.token=s.get("token"),n({method:"GET",url:"http://localhost:3000/accidents?limit="+t.limit+"&offset="+t.offset,headers:{"x-access-token":t.token}}).then(function(e){t.accidents=e.data},function(t){})}t.limit=100,t.offset=0,t.alerts=[],t.token=s.get("token"),t.addAlert=function(){t.alerts.push({msg:"Another alert!"})},t.closeAlert=function(e){t.alerts.splice(e,1)},t.nextAccidents=function(e){t.offset+=e,t.token=s.get("token"),t.offset>0?n({method:"GET",url:"http://localhost:3000/accidents?limit="+t.limit+"&offset="+t.offset+"&token="+t.token,headers:{"x-access-token":t.token}}).then(function(e){t.accidents.length?(t.accidents=e.data,t.disableNext=!1):t.disableNext=!0},function(t){}):console.log("offset negative")},c()}angular.module("RDash").controller("DashboardController",["$scope","Users","Accidents","$http","$cookies",DashboardController]);
function IndexController(o,e){o.go("App"),e.register=!0,e.gotoregister=function(){$scope.register=!0,o.go("/")}}angular.module("RDash").controller("IndexController",["$state","$rootScope",IndexController]);
function LoginController(o,t,e,n,s,a){var r=o.get("token");o.get("user");r&&e.go("App"),t.login=function(){var s={email:t.email,password:t.password};console.log(s),n({method:"POST",url:"http://localhost:3000/authentificate",headers:{"Content-Type":"application/json; charset=utf-8"},data:{email:t.email,password:t.password}}).then(function(t){console.log(t),t.data.success&&(o.put("token",t.data.token),o.putObject("user",t.data.user),a.register=!1,e.go("App"))},function(o){})},t.register=function(){console.log("register is not found"),e.go("Register")}}angular.module("RDash").controller("LoginController",["$cookies","$scope","$state","$http","Login","$rootScope",LoginController]);
angular.module("RDash").controller("MapsController",["$scope","NgMap","$http","Accidents","$cookies",function(t,e,s,c,o){var i=this;i.center=[47.08,-2.39],i.circles=[],i.circle={},i.circles.push(i.circle),i.getlocation=function(){var e={addr:i.addr,radius:i.radius};i.raduis1=i.raduis,s.post("http://localhost:3000/localize",e).success(function(e,c,a,n){if(e){t.PostDataResponse=e;var r=[e.result[0].latitude,e.result[0].longitude];i.setPositions(r),i.circles=[],i.circle={raduis:i.raduis1,position:r},i.circles.push(i.circle),i.center=i.circle.position}t.token=o.get("token"),s({method:"GET",url:"http://localhost:3000/accidents/raduis",params:{raduis:i.raduis,lat:e.result[0].latitude,"long":e.result[0].longitude},headers:{"x-access-token":t.token}}).then(function(t){console.log(t.data.result),i.accidents=t.data.result;for(var e in i.accidents)i.accidents[e].pos=[t.data.result[e].coord.lat,t.data.result[e].coord["long"]],i.accidents[e].name=e;i.setPositions(i.accidents)},function(t){i.accidents=null})}).error(function(t,e,s,c){console.log(t)})},i.setPositions=function(t){i.positions=angular.copy(t)},e.getMap().then(function(t){i.map=t}),i.currentIndex=0,t.place={}}]);
angular.module("RDash").controller("UsersController",["$scope","$http","Users","$cookies",function(e,o,l,n){function s(){l.query(function(o){console.log(o),e.myWelcome=o,console.log(e.myWelcome),console.log(e.myWelcome[0]),e.personalDetails=e.myWelcome})}e.isAllSelected=!1,e.updateUser=function(e){console.log(e),e.isEditable=!1,l.update({id:e._id},e,function(e){console.log(success)})},e.createUser=function(o){o.password="toto",l.save(o,function(o){console.log(o),e.personalDetails.push(o),e.newUser={}})},e.deleteUsers=function(){var o=[];angular.forEach(e.personalDetails,function(n){n.selected?(console.log(n),l["delete"]({id:n._id},function(){console.log("user deleted")},function(e){console.log("user not deleted")})):o.push(n),e.personalDetails=o})},e.personalDetails=[],s(),e.toggleAll=function(){var o=e.isAllSelected;angular.forEach(e.personalDetails,function(e){e.selected=o})},e.optionToggled=function(){e.isAllSelected=e.personalDetails.every(function(e){return e.selected})}}]);
function MasterCtrl(e,t,o,g){var n=992;e.getWidth=function(){return window.innerWidth},e.$watch(e.getWidth,function(o,g){o>=n?angular.isDefined(t.get("toggle"))?e.toggle=!!t.get("toggle"):e.toggle=!0:e.toggle=!1}),e.logout=function(){o.remove("user"),o.remove("token"),g.go("Index")},e.toggleSidebar=function(){e.toggle=!e.toggle,t.put("toggle",e.toggle)},window.onresize=function(){e.$apply()}}angular.module("RDash").controller("MasterCtrl",["$scope","$cookieStore","$cookies","$state",MasterCtrl]);
angular.module("RDash").controller("UserController",["$scope","Users","$cookies",function(e,s,r){user=JSON.parse(r.get("user"));var o=user;e.update=function(){var r={};r=o,r.username=e.user.username,e.user.password&&(r.Password=e.user.password),console.log(r),s.update({id:r._id},r,function(e){console.log(e)})}}]);
function registercontroller(o,e,s,l){console.log("We ARE IN REGISTER FUCK YOU"),o.register2=function(){s({method:"POST",url:"http://localhost:3000/register",headers:{"Content-Type":"application/json; charset=utf-8"},data:{email:o.email,password:o.password,username:o.username}}).then(function(o){console.log(o),console.log(o),o.data.success&&e.go("Login")},function(o){}),console.log(o.username),console.log(o.email),console.log(o.password)}}angular.module("RDash").controller("RegisterController",["$scope","$state","$http","Login",registercontroller]);
function rdLoading(){var d={restrict:"AE",template:'<div class="loading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>'};return d}angular.module("RDash").directive("rdLoading",rdLoading);
function rdWidgetBody(){var d={requires:"^rdWidget",scope:{loading:"=?",classes:"@?"},transclude:!0,template:'<div class="widget-body" ng-class="classes"><rd-loading ng-show="loading"></rd-loading><div ng-hide="loading" class="widget-content" ng-transclude></div></div>',restrict:"E"};return d}angular.module("RDash").directive("rdWidgetBody",rdWidgetBody);
function rdWidgetFooter(){var e={requires:"^rdWidget",transclude:!0,template:'<div class="widget-footer" ng-transclude></div>',restrict:"E"};return e}angular.module("RDash").directive("rdWidgetFooter",rdWidgetFooter);
function rdWidgetTitle(){var i={requires:"^rdWidget",scope:{title:"@",icon:"@"},transclude:!0,template:'<div class="widget-header"><div class="row"><div class="pull-left"><i class="fa" ng-class="icon"></i> {{title}} </div><div class="pull-right col-xs-6 col-sm-4" ng-transclude></div></div></div>',restrict:"E"};return i}angular.module("RDash").directive("rdWidgetHeader",rdWidgetTitle);
function rdWidget(){var d={transclude:!0,template:'<div class="widget" ng-transclude></div>',restrict:"EA"};return d}angular.module("RDash").directive("rdWidget",rdWidget);
angular.module("RDash").factory("Accidents",["$resource",function(c){return c("http://localhost:3000/accidents/id/:accidentId",{accidentId:"@_id"},{update:{method:"PUT"}})}]);
angular.module("RDash").factory("Login",["$resource",function(t){return t("http://localhost:3000/authentificate",{},{update:{method:"PUT"}})}]);
angular.module("RDash").factory("Users",["$resource",function(e){return e("http://localhost:3000/user/:id",{id:"@_id"},{update:{method:"PUT"}})}]);